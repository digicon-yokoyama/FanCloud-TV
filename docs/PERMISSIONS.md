# æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“‹ æ¦‚è¦

FanCloud TV(ä»®)ã§ã¯ã€4éšå±¤ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç‰¹å®šã®ãƒ­ãƒ¼ãƒ«ã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã‚’æŒã¡ã€ãã‚Œã«å¿œã˜ãŸæ¨©é™ã¨æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

## ğŸ·ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«

### 1. System Adminï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ï¼‰
- **æ¨©é™ãƒ¬ãƒ™ãƒ«**: æœ€é«˜
- **èª¬æ˜**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’ç®¡ç†ã™ã‚‹æ¨©é™ã‚’æŒã¤
- **ãƒãƒƒã‚¸**: ğŸ”´ èµ¤è‰²
- **æ©Ÿèƒ½**:
  - å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†
  - ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®å¤‰æ›´
  - Django Admin ã¸ã®ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹
  - é…ä¿¡æ¨©é™ã®ä»˜ä¸/å–ã‚Šæ¶ˆã—
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ã®å¤‰æ›´
  - ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### 2. Tenant Adminï¼ˆãƒ†ãƒŠãƒ³ãƒˆç®¡ç†è€…ï¼‰
- **æ¨©é™ãƒ¬ãƒ™ãƒ«**: é«˜
- **èª¬æ˜**: ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç®¡ç†
- **ãƒãƒƒã‚¸**: ğŸŸ¡ é»„è‰²
- **æ©Ÿèƒ½**:
  - ãƒ†ãƒŠãƒ³ãƒˆå†…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†
  - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç®¡ç†ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  - é…ä¿¡æ¨©é™ã®ä»˜ä¸/å–ã‚Šæ¶ˆã—
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«å¤‰æ›´ï¼ˆSystem Adminé™¤ãï¼‰
  - é…ä¿¡æ©Ÿèƒ½ã®åˆ©ç”¨

### 3. Tenant Userï¼ˆé…ä¿¡è€…ï¼‰
- **æ¨©é™ãƒ¬ãƒ™ãƒ«**: ä¸­
- **èª¬æ˜**: é…ä¿¡ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆã‚’è¡Œã†ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **ãƒãƒƒã‚¸**: ğŸ”µ é’è‰²
- **æ©Ÿèƒ½**:
  - ãƒ©ã‚¤ãƒ–é…ä¿¡ã®é–‹å§‹/çµ‚äº†
  - å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - é…ä¿¡è¨­å®šã®ç®¡ç†
  - ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  - é…ä¿¡çµ±è¨ˆã®ç¢ºèª

### 4. Subscriberï¼ˆç™»éŒ²è€…ï¼‰
- **æ¨©é™ãƒ¬ãƒ™ãƒ«**: åŸºæœ¬
- **èª¬æ˜**: å‹•ç”»è¦–è´ã¨ãƒãƒ£ãƒƒãƒˆå‚åŠ ã‚’è¡Œã†ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **ãƒãƒƒã‚¸**: âš« ã‚°ãƒ¬ãƒ¼
- **æ©Ÿèƒ½**:
  - å‹•ç”»è¦–è´
  - ãƒ©ã‚¤ãƒ–é…ä¿¡è¦–è´
  - ãƒãƒ£ãƒƒãƒˆå‚åŠ 
  - ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²/ãƒ•ã‚©ãƒ­ãƒ¼
  - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†

## ğŸ’³ ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—

### Premiumï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡ï¼‰
- **ãƒãƒƒã‚¸**: â­ é‡‘è‰²
- **ç‰¹å…¸**:
  - é«˜ç”»è³ªé…ä¿¡è¦–è´
  - åºƒå‘Šãªã—è¦–è´
  - ç‰¹åˆ¥ãªãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
  - å„ªå…ˆã‚µãƒãƒ¼ãƒˆ

### Freeï¼ˆç„¡æ–™ä¼šå“¡ï¼‰
- **ãƒãƒƒã‚¸**: ğŸ†“ ãƒ©ã‚¤ãƒˆ
- **åˆ¶é™**:
  - æ¨™æº–ç”»è³ªã§ã®è¦–è´
  - åºƒå‘Šè¡¨ç¤º
  - åŸºæœ¬ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ã¿

## ğŸ”§ æ¨©é™ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

### ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¨©é™åˆ¶å¾¡

```python
# ãƒ­ãƒ¼ãƒ«æŒ‡å®š
@role_required(['system_admin', 'tenant_admin'])
def admin_view(request):
    pass

# ç‰¹å®šãƒ­ãƒ¼ãƒ«é™å®š
@system_admin_required
def system_view(request):
    pass

# é…ä¿¡æ¨©é™å¿…é ˆ
@streaming_permission_required  
def stream_view(request):
    pass

# ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡é™å®š
@premium_required
def premium_view(request):
    pass
```

### ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ç”¨ãƒŸãƒƒã‚¯ã‚¹ã‚¤ãƒ³

```python
class AdminView(PermissionMixin, View):
    required_roles = ['system_admin', 'tenant_admin']
    require_streaming = False
    require_premium = False
```

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯

```html
<!-- ãƒ­ãƒ¼ãƒ«ç¢ºèª -->
{% if perms.is_system_admin %}
    <a href="{% url 'accounts:admin_system' %}">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</a>
{% endif %}

<!-- é…ä¿¡æ¨©é™ç¢ºèª -->
{% if perms.can_stream %}
    <a href="{% url 'streaming:create' %}">é…ä¿¡é–‹å§‹</a>
{% endif %}

<!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ¨©é™ç¢ºèª -->
{% if perms.can_manage_users %}
    <a href="{% url 'accounts:admin_users' %}">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</a>
{% endif %}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼

é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§åˆ©ç”¨å¯èƒ½ãªãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ï¼š

| ãƒ¦ãƒ¼ã‚¶ãƒ¼å | ãƒ­ãƒ¼ãƒ« | ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ— | é…ä¿¡æ¨©é™ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
|-----------|--------|---------------|----------|-----------|------------|
| **sysadmin** | System Admin | Premium | âœ… | test123456 | sysadmin@example.com |
| **tenantadmin** | Tenant Admin | Premium | âœ… | test123456 | tenantadmin@example.com |
| **streamer** | Tenant User | Premium | âœ… | test123456 | streamer@example.com |
| **viewer** | Subscriber | Free | âŒ | test123456 | viewer@example.com |
| **premium_viewer** | Subscriber | Premium | âŒ | test123456 | premium@example.com |

## ğŸŒ é–¢é€£URL

### èªè¨¼ãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†
- **ãƒ­ã‚°ã‚¤ãƒ³**: http://localhost:8000/accounts/login/
- **ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ**: http://localhost:8000/accounts/logout/
- **æ–°è¦ç™»éŒ²**: http://localhost:8000/accounts/register/
- **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: http://localhost:8000/accounts/profile/
- **è¨­å®š**: http://localhost:8000/accounts/settings/

### ç®¡ç†æ©Ÿèƒ½ï¼ˆç®¡ç†è€…æ¨©é™å¿…é ˆï¼‰
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: http://localhost:8000/accounts/admin/users/
- **ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†**: http://localhost:8000/accounts/admin/system/
- **Django Admin**: http://localhost:8000/admin/

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆç®¡ç†è€…æ¨©é™å¿…é ˆï¼‰
- **ãƒ­ãƒ¼ãƒ«æ›´æ–°**: `POST /accounts/admin/api/update-role/`
- **é…ä¿¡æ¨©é™åˆ‡æ›¿**: `POST /accounts/admin/api/toggle-streaming/`
- **ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—æ›´æ–°**: `POST /accounts/admin/api/update-membership/`

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ»é…ä¿¡
- **ãƒ›ãƒ¼ãƒ **: http://localhost:8000/
- **ãƒ©ã‚¤ãƒ–é…ä¿¡ä¸€è¦§**: http://localhost:8000/live/
- **ãƒˆãƒ¬ãƒ³ãƒ‰**: http://localhost:8000/content/trending/
- **ç™»éŒ²ãƒãƒ£ãƒ³ãƒãƒ«**: http://localhost:8000/content/subscriptions/
- **é…ä¿¡é–‹å§‹**: http://localhost:8000/create/ ï¼ˆé…ä¿¡æ¨©é™å¿…é ˆï¼‰

## ğŸ” æ¨©é™ãƒ†ã‚¹ãƒˆæ‰‹é †

### 1. ç®¡ç†è€…æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ

1. `sysadmin` ã¾ãŸã¯ `tenantadmin` ã§ãƒ­ã‚°ã‚¤ãƒ³
2. å³ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
   - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¸ã®è‰²åˆ†ã‘
   - çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º
   - æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½

### 2. æ¨©é™å¤‰æ›´ã®ãƒ†ã‚¹ãƒˆ

1. ç®¡ç†è€…ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œæ“ä½œã€åˆ—ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ­ãƒ¼ãƒ«å¤‰æ›´ã‚’é¸æŠã—ã€å¤‰æ›´ã‚’å®Ÿè¡Œ
4. é…ä¿¡æ¨©é™ã®ä»˜ä¸/å–ã‚Šæ¶ˆã—ã‚’å®Ÿè¡Œ
5. å¤‰æ›´ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### 3. å„ãƒ­ãƒ¼ãƒ«ã§ã®æ©Ÿèƒ½ç¢ºèª

å„ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ä»¥ä¸‹ã‚’ç¢ºèªï¼š

- **System Admin**: å…¨æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
- **Tenant Admin**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
- **Tenant User**: é…ä¿¡é–‹å§‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤º
- **Subscriber**: ç®¡ç†æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- **Premium Member**: ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šæ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

### 4. æ¨©é™ã‚¨ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

1. æ¨©é™ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ç®¡ç†ç”»é¢URLã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œæ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. é©åˆ‡ãªãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

## ğŸ› ï¸ æ¨©é™ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

æ–°ã—ã„æ¨©é™ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

### 1. ãƒ¢ãƒ‡ãƒ«ã«æ¨©é™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

```python
class User(AbstractUser):
    can_moderate = models.BooleanField(default=False)
    
    def can_moderate_content(self):
        return self.can_moderate and self.can_manage_content()
```

### 2. æ¨©é™ãƒã‚§ãƒƒã‚¯é–¢æ•°ã‚’ä½œæˆ

```python
def moderation_required(view_func):
    @wraps(view_func)
    @login_required
    def wrapped_view(request, *args, **kwargs):
        if not request.user.can_moderate_content():
            return HttpResponseForbidden("ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“")
        return view_func(request, *args, **kwargs)
    return wrapped_view
```

### 3. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’æ›´æ–°

```python
def get_user_permissions(user):
    return {
        # æ—¢å­˜ã®æ¨©é™...
        'can_moderate_content': user.can_moderate_content(),
    }
```

## ğŸ“š é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- **ãƒ¢ãƒ‡ãƒ«**: `apps/accounts/models.py`
- **æ¨©é™ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿**: `apps/accounts/permissions.py`
- **ç®¡ç†ãƒ“ãƒ¥ãƒ¼**: `apps/accounts/views_admin.py`
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ­ã‚»ãƒƒã‚µ**: `apps/accounts/context_processors.py`
- **ç®¡ç†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: `templates/accounts/admin/`
- **Django Adminè¨­å®š**: `apps/accounts/admin.py`

---

**ä½œæˆæ—¥**: 2025-09-01  
**æœ€çµ‚æ›´æ–°**: 2025-09-01  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0