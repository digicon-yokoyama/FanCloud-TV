# テンプレートフィルター仕様書

## 時間表示フィルター

### `readable_time`

**概要**: 投稿時間や作成時間を読みやすい相対時間形式で表示するカスタムフィルター

**使用方法**:
```django
{% load time_utils %}
{{ video.created_at|readable_time }}
```

**表示仕様**:

| 経過時間 | 表示形式 | 例 |
|---------|---------|-----|
| 1分未満 | `今` | 今 |
| 1時間未満 | `{分}分前` | 5分前, 30分前, 59分前 |
| 24時間未満 | `{時間}時間前` | 1時間前, 5時間前, 23時間前 |
| 7日未満 | `{日}日前` | 1日前, 3日前, 6日前 |
| 4週間未満 | `{週}週間前` | 1週間前, 2週間前, 3週間前 |
| 1年未満 | `{月}ヶ月前` | 1ヶ月前, 6ヶ月前, 11ヶ月前 |
| 1年以上 | `{年}年前` | 1年前, 2年前 |

**重要な仕様**:
- **単一単位表示**: 最も大きな単位のみを表示し、より小さな単位は切り捨て
  - 例: 1時間25分前 → `1時間前`
  - 例: 2日5時間前 → `2日前`
- **切り捨て処理**: 小数点以下は切り捨て（floor）
- **未来時間対応**: 投稿時間が現在時間より未来の場合は `今` を表示
- **null対応**: 値がない場合は空文字列を返す

**実装場所**: `apps/streaming/templatetags/time_utils.py`

**計算基準**:
```python
# 1分 = 60秒
# 1時間 = 3600秒
# 1日 = 86400秒
# 1週間 = 604800秒
# 1ヶ月 = 2592000秒（30日基準）
# 1年 = 31536000秒（365日基準）
```

**テストケース例**:
```python
# 30分前の投稿 → "30分前"
# 1時間前の投稿 → "1時間前"  
# 1時間25分前の投稿 → "1時間前"（分は切り捨て）
# 2日3時間前の投稿 → "2日前"（時間は切り捨て）
```

**適用箇所**:
- 動画カード（`templates/partials/video_card.html`）
- 投稿時間表示全般